[gd_scene load_steps=23 format=3 uid="uid://dsrc10otv700k"]

[ext_resource type="PackedScene" uid="uid://bvp6i1rvvvnpu" path="res://gltf/hero.glb" id="1_t08r0"]
[ext_resource type="Script" path="res://scene/hero.gd" id="1_wutii"]
[ext_resource type="Script" path="res://class/CharacterInput.gd" id="2_6c5ch"]
[ext_resource type="AnimationLibrary" uid="uid://bioq5x26vsl0h" path="res://animation_library/man_animations.res" id="2_3838d"]
[ext_resource type="Script" path="res://scene/MarkerTracker.gd" id="2_pdvec"]
[ext_resource type="Script" path="res://class/CharacterStateMachine.gd" id="2_v13ok"]
[ext_resource type="Script" path="res://scene/CameraArm.gd" id="3_yw7do"]
[ext_resource type="Script" path="res://class/CharacterStateStanding.gd" id="7_o4t5b"]
[ext_resource type="Script" path="res://class/CharacterStateRunning.gd" id="8_6lnl6"]
[ext_resource type="Script" path="res://class/CharacterStateTargeting.gd" id="9_3udu7"]
[ext_resource type="Script" path="res://class/CharacterStateFalling.gd" id="10_sturr"]
[ext_resource type="Script" path="res://scene/Area3D.gd" id="11_ns56v"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_twn7t"]
radius = 0.25
height = 1.75

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_28xo1"]
albedo_color = Color(0, 1, 0, 1)

[sub_resource type="SphereMesh" id="SphereMesh_a8hk8"]
material = SubResource("StandardMaterial3D_28xo1")
radius = 0.1
height = 0.2
radial_segments = 16
rings = 8

[sub_resource type="AnimationNodeOneShot" id="AnimationNodeOneShot_dixv2"]
fadein_time = 0.25
fadeout_time = 0.25

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_srq43"]
animation = &"man_animations/Idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_n10r7"]
animation = &"man_animations/Punch"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_pl3v3"]
animation = &"man_animations/Run"

[sub_resource type="AnimationNodeBlend2" id="AnimationNodeBlend2_0484k"]

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_x2u1a"]
graph_offset = Vector2(-849.6, 63.2)
nodes/ActionShot/node = SubResource("AnimationNodeOneShot_dixv2")
nodes/ActionShot/position = Vector2(80, 144)
nodes/Animation/node = SubResource("AnimationNodeAnimation_pl3v3")
nodes/Animation/position = Vector2(-464, 256)
"nodes/Animation 2/node" = SubResource("AnimationNodeAnimation_srq43")
"nodes/Animation 2/position" = Vector2(-704, 128)
"nodes/Animation 3/node" = SubResource("AnimationNodeAnimation_n10r7")
"nodes/Animation 3/position" = Vector2(-208, 336)
nodes/RunBlend/node = SubResource("AnimationNodeBlend2_0484k")
nodes/RunBlend/position = Vector2(-192, 112)
node_connections = [&"output", 0, &"ActionShot", &"ActionShot", 0, &"RunBlend", &"ActionShot", 1, &"Animation 3", &"RunBlend", 0, &"Animation 2", &"RunBlend", 1, &"Animation"]

[sub_resource type="CylinderShape3D" id="CylinderShape3D_xx32g"]
radius = 4.0

[node name="Hero" type="CharacterBody3D" node_paths=PackedStringArray("camera_arm", "marker_tracker")]
transform = Transform3D(1, 0, -1.19209e-07, 0, 1, 0, 1.19209e-07, 0, 1, 0, 0, 0)
script = ExtResource("1_wutii")
camera_arm = NodePath("CameraArm")
marker_tracker = NodePath("MarkerTracker")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.875, 0)
shape = SubResource("CapsuleShape3D_twn7t")

[node name="MarkerTracker" type="Node3D" parent="." node_paths=PackedStringArray("character")]
script = ExtResource("2_pdvec")
character = NodePath("..")

[node name="CameraArm" type="Node3D" parent="." node_paths=PackedStringArray("body")]
script = ExtResource("3_yw7do")
body = NodePath("..")

[node name="GreenBall" type="MeshInstance3D" parent="CameraArm"]
visible = false
mesh = SubResource("SphereMesh_a8hk8")
skeleton = NodePath("../..")

[node name="hero" parent="." instance=ExtResource("1_t08r0")]
transform = Transform3D(-1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, 0, 0, 0)

[node name="GeneralSkeleton" parent="hero/Rig" index="0"]
bones/1/position = Vector3(-0.00189118, 0.844428, 0.005103)
bones/1/rotation = Quaternion(0.0752392, -0.0646169, -0.0182805, 0.994902)
bones/2/rotation = Quaternion(0.0323789, 0.0143857, 0.0341021, 0.99879)
bones/3/rotation = Quaternion(0.0324315, 0.0202705, -0.00818381, 0.999235)
bones/4/rotation = Quaternion(0.0305173, 0.0185852, -0.00842073, 0.999326)
bones/5/rotation = Quaternion(0.571061, 0.421349, 0.524248, -0.470658)
bones/6/rotation = Quaternion(0.0255818, 0.855777, -0.495288, -0.147242)
bones/7/rotation = Quaternion(0.585145, -0.396943, 0.585145, 0.397047)
bones/8/rotation = Quaternion(0.0258733, 0.404488, 0.0494787, 0.912837)
bones/9/rotation = Quaternion(0.180327, -2.5779e-06, -0.0217621, 0.983366)
bones/10/rotation = Quaternion(0.0905405, -1.38581e-06, -0.0109264, 0.995833)
bones/11/rotation = Quaternion(2.98023e-08, -2.98023e-08, 2.98023e-08, 1)
bones/12/rotation = Quaternion(0.180464, -1.95205e-06, -0.0217785, 0.983341)
bones/13/rotation = Quaternion(0.0905406, -1.01328e-06, -0.0109265, 0.995833)
bones/14/rotation = Quaternion(-2.98023e-08, 0, 0, 1)
bones/15/rotation = Quaternion(0.184592, 0.00639275, 0.013036, 0.982708)
bones/16/rotation = Quaternion(0.0905406, -3.72529e-07, -0.0109265, 0.995833)
bones/18/rotation = Quaternion(0.180327, -3.38256e-06, -0.021762, 0.983366)
bones/19/rotation = Quaternion(0.0905406, -1.69873e-06, -0.0109264, 0.995833)
bones/20/rotation = Quaternion(2.98023e-08, 2.98023e-08, -2.98023e-08, 1)
bones/21/rotation = Quaternion(-0.0849194, 0.73822, 0.0726433, 0.665239)
bones/22/rotation = Quaternion(0.0770746, 0.0186041, -0.021421, 0.996622)
bones/23/rotation = Quaternion(1.49012e-08, -1.04308e-07, 0, 1)
bones/24/rotation = Quaternion(0.566294, -0.430588, -0.527909, -0.463916)
bones/25/rotation = Quaternion(-0.0605523, 0.884317, -0.43548, 0.157081)
bones/26/rotation = Quaternion(0.502918, 0.497109, -0.502918, 0.497021)
bones/27/rotation = Quaternion(0.0559933, -0.666117, -0.063101, 0.741061)
bones/28/rotation = Quaternion(0.180301, -2.22027e-06, 0.0219729, 0.983366)
bones/29/rotation = Quaternion(0.0905278, -1.10269e-06, 0.0110323, 0.995833)
bones/30/rotation = Quaternion(0, -1.49012e-08, -1.49012e-08, 1)
bones/31/rotation = Quaternion(0.180301, -2.08616e-06, 0.0219729, 0.983366)
bones/32/rotation = Quaternion(0.0905278, -1.01328e-06, 0.0110322, 0.995833)
bones/33/rotation = Quaternion(-1.49012e-08, -1.49012e-08, -1.49012e-08, 1)
bones/34/rotation = Quaternion(0.180301, 7.00355e-07, 0.021973, 0.983366)
bones/35/rotation = Quaternion(0.0905278, -1.62423e-06, 0.0110323, 0.995833)
bones/36/rotation = Quaternion(0, -5.96046e-08, 0, 1)
bones/37/rotation = Quaternion(0.180301, -7.89762e-07, 0.021973, 0.983366)
bones/38/rotation = Quaternion(0.0905278, -3.57628e-07, 0.0110322, 0.995833)
bones/39/rotation = Quaternion(0, -2.98023e-08, -2.98023e-08, 1)
bones/40/rotation = Quaternion(-0.0769202, -0.741812, -0.0720643, 0.662273)
bones/41/rotation = Quaternion(0.0622886, -0.0110586, 0.0222511, 0.997749)
bones/42/rotation = Quaternion(-1.49012e-08, -1.04308e-07, 0, 1)
bones/43/rotation = Quaternion(0.00687785, 0.00820554, 0.00296193, 0.999938)
bones/44/rotation = Quaternion(-0.292791, 0.0347291, 0.0210861, 0.955313)
bones/45/rotation = Quaternion(0.14181, 0.283828, 0.946373, -0.0609072)
bones/46/rotation = Quaternion(-0.0750769, 0.693631, -0.715599, 0.0340207)
bones/47/rotation = Quaternion(0.0539249, 0.750179, -0.657038, -0.0512278)
bones/48/rotation = Quaternion(0.000353888, 0.999792, -0.0203807, -0.000226263)
bones/49/rotation = Quaternion(0.0079975, 0.289984, 0.95695, -0.00956363)
bones/50/rotation = Quaternion(-0.0366589, 0.890864, -0.448964, -0.0587321)
bones/51/rotation = Quaternion(-0.0362292, 0.520159, -0.851923, 0.0484717)
bones/52/rotation = Quaternion(-8.33015e-06, 1, 0.000587136, 6.44201e-06)

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
root_node = NodePath("../hero/Rig/GeneralSkeleton")
libraries = {
"man_animations": ExtResource("2_3838d")
}

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeBlendTree_x2u1a")
anim_player = NodePath("../AnimationPlayer")
active = true
parameters/ActionShot/active = false
parameters/ActionShot/internal_active = false
parameters/ActionShot/request = 0
parameters/RunBlend/blend_amount = 1.0

[node name="CharacterInput" type="Node" parent="." node_paths=PackedStringArray("body", "camera_arm")]
script = ExtResource("2_6c5ch")
body = NodePath("..")
camera_arm = NodePath("../CameraArm")

[node name="CharacterStateMachine" type="Node" parent="." node_paths=PackedStringArray("body", "camera_arm", "marker_tracker", "animation_player", "animation_tree", "input", "initial_state", "standing_state", "running_state", "targeting_state", "falling_state")]
script = ExtResource("2_v13ok")
body = NodePath("..")
camera_arm = NodePath("../CameraArm")
marker_tracker = NodePath("../MarkerTracker")
animation_player = NodePath("../AnimationPlayer")
animation_tree = NodePath("../AnimationTree")
input = NodePath("../CharacterInput")
initial_state = NodePath("CharacterStateStanding")
standing_state = NodePath("CharacterStateStanding")
running_state = NodePath("CharacterStateRunning")
targeting_state = NodePath("CharacterStateTargeting")
falling_state = NodePath("CharacterStateFalling")

[node name="CharacterStateStanding" type="Node" parent="CharacterStateMachine"]
script = ExtResource("7_o4t5b")

[node name="CharacterStateRunning" type="Node" parent="CharacterStateMachine"]
script = ExtResource("8_6lnl6")
speed = 5

[node name="CharacterStateTargeting" type="Node" parent="CharacterStateMachine"]
script = ExtResource("9_3udu7")
speed = 5

[node name="CharacterStateFalling" type="Node" parent="CharacterStateMachine"]
script = ExtResource("10_sturr")

[node name="Area3D" type="Area3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -2)
script = ExtResource("11_ns56v")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Area3D"]
shape = SubResource("CylinderShape3D_xx32g")

[connection signal="body_entered" from="Area3D" to="MarkerTracker" method="_on_area_3d_body_entered"]
[connection signal="body_exited" from="Area3D" to="MarkerTracker" method="_on_area_3d_body_exited"]

[editable path="hero"]
